#include <board.h>
#include <sysclk.h>
#include <st7565r.h>
#include <conf_usart_example.h>
#include "led.h"

const int Characters[][] = {
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,          /* " " */
	0x20, 0x20, 0x20, 0x20, 0x20, 0x00, 0x20,          /* "!" */
	0x50, 0x50, 0x50, 0x00, 0x00, 0x00, 0x00,          /* """ */
	0x50, 0x50, 0xf8, 0x50, 0xf8, 0x50, 0x50,          /* "#" */
	0x20, 0x78, 0xa0, 0x70, 0x28, 0xf0, 0x20,          /* "$" */
	0xc0, 0xc8, 0x10, 0x20, 0x40, 0x98, 0x18,          /* "%" */
	0x60, 0x90, 0xa0, 0x40, 0xa8, 0x90, 0x68,          /* "&" */
	0x60, 0x20, 0x40, 0x00, 0x00, 0x00, 0x00,          /* "'" */
	0x10, 0x20, 0x40, 0x40, 0x40, 0x20, 0x10,          /* "(" */
	0x40, 0x20, 0x10, 0x10, 0x10, 0x20, 0x40,          /* ")" */
	0x00, 0x50, 0x20, 0xf8, 0x20, 0x50, 0x00,          /* "*" */
	0x00, 0x20, 0x20, 0xf8, 0x20, 0x20, 0x00,          /* "+" */
	0x00, 0x00, 0x00, 0x00, 0x60, 0x20, 0x40,          /* "," */
	0x00, 0x00, 0x00, 0xf8, 0x00, 0x00, 0x00,          /* "-" */
	0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0x60,          /* "." */
	0x00, 0x08, 0x10, 0x20, 0x40, 0x80, 0x00,          /* "/" */
	0x70, 0x88, 0x98, 0xa8, 0xc8, 0x88, 0x70,          /* "0" */
	0x20, 0x60, 0x20, 0x20, 0x20, 0x20, 0x70,          /* "1" */
	0x70, 0x88, 0x08, 0x10, 0x20, 0x40, 0xf8,          /* "2" */
	0xf8, 0x10, 0x20, 0x10, 0x08, 0x88, 0x70,          /* "3" */
	0x10, 0x30, 0x50, 0x90, 0xf8, 0x10, 0x10,          /* "4" */
	0xf8, 0x80, 0xf0, 0x08, 0x08, 0x88, 0x70,          /* "5" */
	0x30, 0x40, 0x80, 0xf0, 0x88, 0x88, 0x70,          /* "6" */
	0xf8, 0x08, 0x10, 0x20, 0x40, 0x40, 0x40,          /* "7" */
	0x70, 0x88, 0x88, 0x70, 0x88, 0x88, 0x70,          /* "8" */
	0x70, 0x88, 0x88, 0x78, 0x08, 0x10, 0x60,          /* "9" */
	0x00, 0x60, 0x60, 0x00, 0x60, 0x60, 0x00,          /* ":" */
	0x00, 0x60, 0x60, 0x00, 0x60, 0x20, 0x40,          /* ";" */
	0x08, 0x10, 0x20, 0x40, 0x20, 0x10, 0x08,          /* "<" */
	0x00, 0x00, 0xf8, 0x00, 0xf8, 0x00, 0x00,          /* "=" */
	0x80, 0x40, 0x20, 0x10, 0x20, 0x40, 0x80,          /* ">" */
	0x70, 0x88, 0x08, 0x10, 0x20, 0x00, 0x20,          /* "?" */
	0x70, 0x88, 0x08, 0x68, 0xa8, 0xa8, 0x70,          /* "@" */
	0x70, 0x88, 0x88, 0x88, 0xf8, 0x88, 0x88,          /* "A" */
	0xf0, 0x88, 0x88, 0xf0, 0x88, 0x88, 0xf0,          /* "B" */
	0x70, 0x88, 0x80, 0x80, 0x80, 0x88, 0x70,          /* "C" */
	0xe0, 0x90, 0x88, 0x88, 0x88, 0x90, 0xe0,          /* "D" */
	0xf8, 0x80, 0x80, 0xf0, 0x80, 0x80, 0xf8,          /* "E" */
	0xf8, 0x80, 0x80, 0xe0, 0x80, 0x80, 0x80,          /* "F" */
	0x70, 0x88, 0x80, 0x80, 0x98, 0x88, 0x70,          /* "G" */
	0x88, 0x88, 0x88, 0xf8, 0x88, 0x88, 0x88,          /* "H" */
	0x70, 0x20, 0x20, 0x20, 0x20, 0x20, 0x70,          /* "I" */
	0x38, 0x10, 0x10, 0x10, 0x10, 0x90, 0x60,          /* "J" */
	0x88, 0x90, 0xa0, 0xc0, 0xa0, 0x90, 0x88,          /* "K" */
	0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0xf8,          /* "L" */
	0x88, 0xd8, 0xa8, 0x88, 0x88, 0x88, 0x88,          /* "M" */
	0x88, 0x88, 0xc8, 0xa8, 0x98, 0x88, 0x88,          /* "N" */
	0x70, 0x88, 0x88, 0x88, 0x88, 0x88, 0x70,          /* "O" */
	0xf0, 0x88, 0x88, 0xf0, 0x80, 0x80, 0x80,          /* "P" */
	0x70, 0x88, 0x88, 0x88, 0xa8, 0x90, 0x68,          /* "Q" */
	0xf0, 0x88, 0x88, 0xf0, 0xa0, 0x90, 0x88,          /* "R" */
	0x78, 0x80, 0x80, 0x70, 0x08, 0x08, 0xf0,          /* "S" */
	0xf8, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,          /* "T" */
	0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x70,          /* "U" */
	0x88, 0x88, 0x88, 0x88, 0x88, 0x50, 0x20,          /* "V" */
	0x88, 0x88, 0x88, 0xa8, 0xa8, 0xd8, 0x88,          /* "W" */
	0x88, 0x88, 0x50, 0x20, 0x50, 0x88, 0x88,          /* "X" */
	0x88, 0x88, 0x50, 0x20, 0x20, 0x20, 0x20,          /* "Y" */
	0xf8, 0x08, 0x10, 0x20, 0x40, 0x80, 0xf8,          /* "Z" */
	0x38, 0x20, 0x20, 0x20, 0x20, 0x20, 0x38,          /* "[" */
	0x00, 0x80, 0x40, 0x20, 0x10, 0x08, 0x00,          /* "" */
	0xe0, 0x20, 0x20, 0x20, 0x20, 0x20, 0xe0,          /* "]" */
	0x20, 0x50, 0x88, 0x00, 0x00, 0x00, 0x00,          /* "^" */
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf8,          /* "_" */
	0x40, 0x20, 0x10, 0x00, 0x00, 0x00, 0x00,          /* "`" */
	0x00, 0x00, 0x70, 0x08, 0x78, 0x88, 0x78,          /* "a" */
	0x80, 0x80, 0xb0, 0xc8, 0x88, 0x88, 0xf0,          /* "b" */
	0x00, 0x00, 0x70, 0x80, 0x80, 0x88, 0x70,          /* "c" */
	0x08, 0x08, 0x68, 0x98, 0x88, 0x88, 0x78,          /* "d" */
	0x00, 0x00, 0x70, 0x88, 0xf8, 0x80, 0x70,          /* "e" */
	0x30, 0x48, 0x40, 0xe0, 0x40, 0x40, 0x40,          /* "f" */
	0x00, 0x00, 0x78, 0x88, 0x78, 0x08, 0x30,          /* "g" */
	0x80, 0x80, 0xb0, 0xc8, 0x88, 0x88, 0x88,          /* "h" */
	0x20, 0x00, 0x60, 0x20, 0x20, 0x20, 0x70,          /* "i" */
	0x10, 0x00, 0x30, 0x10, 0x10, 0x90, 0x60,          /* "j" */
	0x40, 0x40, 0x48, 0x50, 0x60, 0x50, 0x48,          /* "k" */
	0x60, 0x20, 0x20, 0x20, 0x20, 0x20, 0x70,          /* "l" */
	0x00, 0x00, 0xd0, 0xa8, 0xa8, 0x88, 0x88,          /* "m" */
	0x00, 0x00, 0xb0, 0xc8, 0x88, 0x88, 0x88,          /* "n" */
	0x00, 0x00, 0x70, 0x88, 0x88, 0x88, 0x70,          /* "o" */
	0x00, 0x00, 0xf0, 0x88, 0xf0, 0x80, 0x80,          /* "p" */
	0x00, 0x00, 0x68, 0x98, 0x78, 0x08, 0x08,          /* "q" */
	0x00, 0x00, 0xb0, 0xc8, 0x80, 0x80, 0x80,          /* "r" */
	0x00, 0x00, 0x70, 0x80, 0x70, 0x08, 0xf0,          /* "s" */
	0x40, 0x40, 0xe0, 0x40, 0x40, 0x48, 0x30,          /* "t" */
	0x00, 0x00, 0x88, 0x88, 0x88, 0x98, 0x68,          /* "u" */
	0x00, 0x00, 0x88, 0x88, 0x88, 0x50, 0x20,          /* "v" */
	0x00, 0x00, 0x88, 0x88, 0xa8, 0xa8, 0x50,          /* "w" */
	0x00, 0x00, 0x88, 0x50, 0x20, 0x50, 0x88,          /* "x" */
	0x00, 0x00, 0x88, 0x88, 0x78, 0x08, 0x70,          /* "y" */
	0x00, 0x00, 0xf8, 0x10, 0x20, 0x40, 0xf8,          /* "z" */
	0x10, 0x20, 0x20, 0x40, 0x20, 0x20, 0x10,          /* "{" */
	0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,          /* "|" */
	0x40, 0x20, 0x20, 0x10, 0x20, 0x20, 0x40,          /* "}" */
};

int main(void)
{
	//! the page address to write to
	uint8_t page_address;
	//! the column address, or the X pixel.
	uint8_t column_address;
	//! store the LCD controller start draw line
	uint8_t start_line_address = 0;

	board_init();
	sysclk_init();

	gpio_set_pin_high(NHD_C12832A1Z_BACKLIGHT); //turns backlight on

	// initialize the interface (SPI), ST7565R LCD controller and LCD
	st7565r_init();

	// set addresses at beginning of display
	st7565r_set_page_address(0);
	st7565r_set_column_address(0);

	uint8_t tx_buf[] = "\n\rWhat would you like to add ? (1-9) : ";
	uint8_t tx_length = 37;
	uint8_t received_byte;
	
	uint8_t i;
	
	uint8_t num1,num2,num3,num4,out,out1;
	
	
	
	/* Initialize the board.
	* The board-specific conf_board.h file contains the configuration of
	* the board initialization.
	*/
	board_init();
	sysclk_init();
	
	// USART options.
	static usart_rs232_options_t USART_SERIAL_OPTIONS = {
		.baudrate = USART_SERIAL_EXAMPLE_BAUDRATE,
		.charlength = USART_SERIAL_CHAR_LENGTH,
		.paritytype = USART_SERIAL_PARITY,
		.stopbits = USART_SERIAL_STOP_BIT
	};
	
	// Initialize usart driver in RS232 mode
	usart_init_rs232(USART_SERIAL_EXAMPLE, &USART_SERIAL_OPTIONS);
	
	// Send "message header"
	for (i = 0; i < tx_length; i++) {
		usart_putchar(USART_SERIAL_EXAMPLE, tx_buf[i]);
	}
	
	// Get and echo a character forever, specific '\r' processing.
	while (true)
	{
		received_byte = usart_getchar(USART_SERIAL_EXAMPLE);
		if (received_byte == '\r') {
			for (i = 0; i < tx_length; i++) {
				usart_putchar(USART_SERIAL_EXAMPLE, tx_buf[i]);
			}
		}
		else
		{
			
			
			num1=usart_getchar(USART_SERIAL_EXAMPLE);
			usart_putchar(USART_SERIAL_EXAMPLE,num1);
			usart_putchar(USART_SERIAL_EXAMPLE, '+' );
			num2=usart_getchar(USART_SERIAL_EXAMPLE);
			usart_putchar(USART_SERIAL_EXAMPLE,num2);
			usart_putchar(USART_SERIAL_EXAMPLE, '=');
			
			num3=num1-48;
			num4=num2-48;
			out=num3+num4;
			out1=out+48;
			
			if(out>=48 ||out<=57){
				
				usart_putchar(USART_SERIAL_EXAMPLE, out1);
			usart_putchar(USART_SERIAL_EXAMPLE, '\r');       }
			
			else if (out<48){
				usart_putchar(USART_SERIAL_EXAMPLE, '!' );
				
			}
			
			else
			{
				
				out1=out+48;
				usart_putchar(USART_SERIAL_EXAMPLE, out1);
				usart_putchar(USART_SERIAL_EXAMPLE, '\r');
			}
		}
		
	}
}